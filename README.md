# Voting App

Decentralized election platform that combines Ethereum smart contracts with a React/Vite frontend. Administrators create and manage elections while users vote securely through MetaMask on the Hardhat local blockchain.

## Features
- **Role-based access control:** On-chain admin management via `Auth.sol`
- **Complete election lifecycle:** Create, vote, compute results, and publish immutable outcomes
- **MetaMask integration:** Automatic wallet connection and network validation
- **Security-first design:** Multi-layer authentication, periodic admin verification, protected routes
- **User-friendly interface:** React 19 + Material UI with real-time election status

## Architecture
- **Smart contracts (Hardhat / Solidity 0.8.28):** `Auth` manages admin roles; `ElectionManager` stores elections, tracks votes, computes outcomes, and persists final tallies.
- **Frontend (React + Vite + Ethers v6):** `AuthProvider` wraps the app, syncing wallet state and exposing admin actions. Feature modules cover login, election browsing, admin tools, and result publication.
- **Tooling:** Hardhat Toolbox, dotenv for secrets, pnpm for dependency management, Material UI theming.

### Project Structure
```
contracts/                 # Solidity sources
artifacts/                 # Generated ABIs after Hardhat compile/deploy
scripts/deploy.js          # Deploys Auth + ElectionManager in sequence
frontend/vite-project/     # React application (pnpm, Vite, MUI)
  src/
    contexts/AuthProvider   # Wallet + admin state management
    features/
      user-auth             # Login flow & wallet utilities
      election              # Election listing, cards, services
      admin-management      # Create elections & publish results
```

## Prerequisites
- Node.js 18+ (recommended) with pnpm installed globally (`npm install -g pnpm`)
- MetaMask browser extension configured for the Hardhat local chain (chain id `31337`)
- Optional: Hardhat-compatible private key in `.env` for scripted deployments

## Setup & Installation
1. Install backend dependencies (from repo root):
   ```bash
   pnpm install
   ```
2. Install frontend dependencies:
   ```bash
   cd frontend/vite-project
   pnpm install
   ```

## Environment Configuration

The deployment script automatically updates the frontend `.env` file with contract addresses. No manual configuration needed!

**Root `.env`** (optional, for Hardhat):
```ini
PRIVATE_KEY=0xabc123...    # Deployer account private key
```

**Frontend `.env`** (auto-generated by deploy script):
```ini
VITE_CONTRACT_ADDRESS=0xAuthContractAddress
VITE_ELECTION_MANAGER_ADDRESS=0xElectionManagerAddress
```

## Quick Start

1. **Start Hardhat node** (Terminal 1):
   ```bash
   npx hardhat node
   ```

2. **Deploy contracts** (Terminal 2):
   ```bash
   npx hardhat run scripts/deploy.js --network localhost
   ```
   The script automatically updates `frontend/vite-project/.env` with contract addresses.

3. **Start frontend** (Terminal 3):
   ```bash
   cd frontend/vite-project
   pnpm dev
   ```
   Visit `http://localhost:5173` and connect MetaMask (Chain ID: 31337).

## Usage

### For Voters
- Connect MetaMask and login
- Browse upcoming and live elections
- Cast one vote per election (double-voting prevented on-chain)
- View published results with vote counts and winners

### For Administrators
- **Create Elections:** Set title, description, candidates, and time range
- **Manage Results:** View expired elections, compute winners, publish immutable results
- **Manage Admins:** Add or remove administrator addresses (wallet addresses only, never private keys)
- Automatic logout if admin privileges are revoked

## Security Features

The application implements multiple security layers:

- **Blockchain verification:** Admin status always verified from on-chain contracts, never trusted from localStorage
- **Network validation:** Strict enforcement of Chain ID 31337 (Hardhat local)
- **Real-time monitoring:** Detects account/network changes and re-validates permissions
- **Periodic re-validation:** Admin status checked every 30 seconds; auto-logout if privileges revoked
- **Protected routes:** All sensitive pages require authentication and correct network
- **Input validation:** Ethereum address format validation, contract address checks
- **Complete logout:** Clears all authentication state and localStorage

**Security Best Practices:**
- Never enter private keys in the frontend (use wallet addresses only)
- Admin operations require MetaMask transaction approval
- All state changes are verified against the blockchain
- Failed operations show clear error messages

## Testing

Run the test suite:
```bash
# Run all 20 tests
npm test

# With gas reporting
npm run test:gas

# With coverage
npm run test:coverage
```

**Test Coverage:** 20 tests (6 for Auth, 14 for ElectionManager) covering deployment, access control, voting mechanics, result computation, and complete lifecycle.

**Frontend Linting:**
```bash
cd frontend/vite-project
pnpm lint
```
